<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de QR Code de Contact</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }
        #qrcode {
            margin-top: 20px;
        }
        #download-link {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">Générateur de QR Code de Contact</h1>
        <div class="card">
            <div class="card-body">
                <form id="contact-form">
                    <div class="form-group">
                        <label for="username">Nom d'utilisateur:</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="name">Nom:</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Téléphone:</label>
                        <input type="text" class="form-control" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="profession">Profession:</label>
                        <select class="form-control" id="profession" name="profession" required>
                            <option value="">Sélectionnez une profession</option>
                            <option value="Developpeur">Developpeur</option>
                            <option value="Designer">Designer</option>
                            <!-- Ajoutez d'autres options manuellement pour tester -->
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">Générer le QR Code</button>
                </form>
                <div id="qrcode" class="text-center"></div>
                <a id="download-link" class="btn btn-info" style="display:none">Télécharger le QR Code</a>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#contact-form').submit(function(event) {
                event.preventDefault();
                console.log("Form submitted");

                var username = $('#username').val();
                var name = $('#name').val();
                var phone = $('#phone').val();
                var email = $('#email').val();
                var profession = $('#profession').val();

                var contactInfo = `MECARD:N:${name};TEL:${phone};EMAIL:${email};NOTE:${profession};;`;
                console.log("Contact Info: ", contactInfo);

                $('#qrcode').empty();

                try {
                    var qrcode = new QRCode(document.getElementById("qrcode"), {
                        text: contactInfo,
                        width: 256,
                        height: 256,
                        colorDark: "#000000",
                        colorLight: "#ffffff"
                    });
                    console.log("QR code generated");
                } catch (error) {
                    console.error("Error generating QR code: ", error);
                }

                setTimeout(() => {
                    var img = $('#qrcode').find('img').attr('src');
                    if (img) {
                        $('#download-link').attr('href', img);
                        $('#download-link').attr('download', 'qrcode.png');
                        $('#download-link').show();
                        console.log("QR code image found: ", img);
                    } else {
                        console.error("QR code image not found.");
                    }
                }, 1000);
            });
        });
    </script>
</body>
</html>
